{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "vnetName": {
            "type": "string",
            "defaultValue": "hubVnet",
            "metadata": {
                "description": "Le Hub"
            }
        },

        "bastionName": {
            "type": "string",
            "defaultValue": "AzureBastion",
            "metadata": {
                "description": "la ressource Bastion"
            }
        },


        "bastionSubnet": {
            "type": "string",
            "defaultValue": "AzureBastionSubnet",
            "metadata": {
                "description": "la ressource Bastion"
            }
        },

        "firewallName": {
            "type": "string",
            "defaultValue": "AzureFirewall",
            "metadata": {
                "description": "la ressource firewall"
            }
        },

        "firewallSubnet": {
            "type": "string",
            "defaultValue": "AzureFirewallSubnet",
            "metadata": {
                "description": "la ressource firewall"
            }
        },

        "bastionPublicAdress": {
            "type": "string",
            "defaultValue": "bastionPublicIPAddress",
            "metadata": {
                "description": "la ressource firewall"
            }
        },

        "firewallPublicAdress": {
            "type": "string",
            "defaultValue": "firewallPublicIPAddress",
            "metadata": {
                "description": "la ressource firewall"
            }
        },

        "gatewayPublicAdress": {
            "type": "string",
            "defaultValue": "gatewayPublicIPAddress",
            "metadata": {
                "description": "la ressource firewall"
            }
        },

        "gatewayName": {
            "type": "string",
            "defaultValue": "Gateway",
            "metadata": {
                "description": "la ressource Gateway"
            }
        },


        "gatewaySubnet": {
            "type": "string",
            "defaultValue": "GatewaySubnet",
            "metadata": {
                "description": "la ressource Gateway"
            }
        }

    },
    "functions": [],
    "variables": {},
    "resources": [


        /////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////// Vnet /////////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////
        {
            "name": "[parameters('vnetName')]",
            "type": "Microsoft.Network/virtualNetworks",
            "apiVersion": "2020-11-01",
            "location": "[resourceGroup().location]",
            "tags": {
                "displayName": "[parameters('vnetName')]"
            },
            "properties": {
                "addressSpace": {
                    "addressPrefixes": [
                        "10.16.0.0/16"
                    ]
                },
                "subnets": [

                    {

                        "name": "[parameters('bastionSubnet')]",

                        "properties": {

                            "addressPrefix": "10.16.0.0/26"

                        }

                    },



                    {

                        "name": "[parameters('firewallSubnet')]",

                        "properties": {

                            "addressPrefix": "10.16.0.64/26"

                        }

                    },


                    {

                        "name": "[parameters('gatewaySubnet')]",

                        "properties": {

                            "addressPrefix": "10.16.0.128/26"

                        }

                    }
                ]
            }
        },

        /////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////// Firewall /////////////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////

        {
            "name": "[parameters('firewallName')]",
            "type": "Microsoft.Network/azureFirewalls",
            "apiVersion": "2020-11-01",
            "location": "[resourceGroup().location]",
            "dependsOn": [
                "[resourceId('Microsoft.Network/publicIPAddresses', parameters('firewallPublicAdress'))]",
                "[resourceId('Microsoft.Network/virtualNetworks', parameters('vnetName'))]"
            ],
            "properties": {

                "ipConfigurations": [
                    {
                        "name": "ipConfigName",
                        "properties": {
                            "privateIPAllocationMethod": "Dynamic",
                            "subnet": {
                                "id": "[resourceId('virtualNetworkResourceGroup', 'Microsoft.Network/virtualNetworks/subnets', parameters('vnetName'), parameters('firewallSubnet'))]"
                            },
                            "publicIPAddress": {
                                "id": "[resourceId('Microsoft.Network/publicIPAddresses', parameters('firewallPublicAdress'))]"
                            }
                        }
                    }
                ]
            }
        },


        /////////////////////////////////////////////////////////////////////////////////////////////////////
        ////////////////////////////////////////////// Firewall PublicIP ////////////////////////////////////
        /////////////////////////////////////////////////////////////////////////////////////////////////////


        {
            "name": "[parameters('firewallPublicAdress')]",
            "type": "Microsoft.Network/publicIPAddresses",
            "apiVersion": "2020-11-01",
            "location": "[resourceGroup().location]",
            "sku": {
                "name": "Standard"
            },
            "tags": {
                "createdFor": "[parameters('firewallName')]"
            },
            "properties": {
                "publicIPAllocationMethod": "Static"
                //             "dnsSettings": {
                //                 "domainNameLabel": "[concat(parameters('firewallName'), uniqueString(resourceGroup().id))]"
                //             }
            }
        }








    ],
    "outputs": {}
}